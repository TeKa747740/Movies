<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: 'Tahoma', sans-serif;
      padding: 20px;
    }

    .details-container {
      max-width: 800px;
      margin: auto;
      background-color: #1a1a1a;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 10px #000;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .details-container img {
      max-width: 100%;
      border-radius: 10px;
    }

    .details-container h1 {
      color: red;
      margin: 20px 0 10px;
      font-size: 2rem;
      text-align: center;
    }

    .details-container p {
      font-size: 1rem;
      margin-bottom: 10px;
      color: #ccc;
      text-align: center;
    }

    .details-buttons {
      margin-top: 20px;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .details-buttons a {
      background-color: red;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      text-decoration: none;
      transition: background-color 0.3s ease;
    }

    .details-buttons a:hover {
      background-color: darkred;
    }

    .cast-list {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      margin-top: 30px;
    }
    .cast-member {
      width: 120px;
      text-align: center;
    }
    .cast-member img {
      width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 0 5px #000;
    }
    .cast-member strong {
      display: block;
      margin-top: 5px;
      color: #fff;
      font-size: 0.9rem;
    }
    .cast-member p {
      margin: 0;
      color: #aaa;
      font-size: 0.8rem;
    }

    #video-player-container {
      display: none;
      margin-top: 20px;
      text-align: center;
    }

    #video-player {
      max-width: 100%;
      border-radius: 10px;
      box-shadow: 0 0 10px #000;
    }
  </style>
</head>
<body>

  <div class="details-container">
    <img id="details-image" src="" alt="poster">
    <h1 id="details-title">Ø¹Ù†ÙˆØ§Ù†</h1>
    <p id="details-rating">â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</p>
    <p id="details-description">Ø§Ù„ÙˆØµÙ</p>

    <div class="details-buttons">
      <a id="watch-link" href="#">ğŸ¬ Ù…Ø´Ø§Ù‡Ø¯Ø© Ù…Ø¨Ø§Ø´Ø±Ø©</a>
      <a id="download-link" href="#" target="_blank">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„</a>
      <a href="index.html">ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>

    <div id="parts-section" style="width:100%;margin:30px auto 0 auto;max-width:800px;display:none;">
      <h2 style="color:red;text-align:center;font-size:1.3rem;">Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ / Ø§Ù„Ù…ÙˆØ§Ø³Ù…</h2>
      <div id="parts-list" style="display:flex;gap:15px;overflow-x:auto;justify-content:center;"></div>
    </div>
    <!-- âœ… Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ -->
    <div id="video-player-container">
      <video id="video-player" controls>
        <source id="video-source" src="" type="video/mp4">
        Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.
      </video>
    </div>
  </div>

  <!-- âœ… Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ -->
  <h2 style="text-align:center; margin-top: 40px;">Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„</h2>
  <div id="cast-container" class="cast-list"></div>

  <script src="tmdb-fetch.js"></script>
  <script>
    // âœ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
    const urlParams = new URLSearchParams(window.location.search);
    const tmdbId = urlParams.get("tmdb_id");
    const title = decodeURIComponent(urlParams.get("title") || "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†");
    const rating = decodeURIComponent(urlParams.get("rating") || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ");
    const image = decodeURIComponent(urlParams.get("image") || "");
    const description = decodeURIComponent(urlParams.get("description") || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ.");
    const watchLink = decodeURIComponent(urlParams.get("watchLink") || "#");
    const downloadLink = decodeURIComponent(urlParams.get("downloadLink") || "#");
    const castData = urlParams.get("cast");
    const fromSection = urlParams.get("from");

    window.defaultPoster = "https://via.placeholder.com/400x600?text=No+Image";
    // Ù„Ø§ ØªØ¹Ø±Ù‘Ù API_KEY Ùˆ BASE_URL Ùˆ IMAGE_BASE_URL Ù‡Ù†Ø§ØŒ Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ù…Ù† tmdb-fetch.js

    document.getElementById("details-title").textContent = title;
    document.getElementById("details-rating").textContent = `â­ ${rating}`;
    document.getElementById("details-description").textContent = description;
    document.getElementById("details-image").src = image || window.defaultPoster;
    document.getElementById("details-image").onerror = function() {
      this.src = window.defaultPoster;
    };
    document.getElementById("download-link").href = downloadLink;

    // Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø³Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚
    const backBtn = document.createElement('a');
    backBtn.textContent = 'â¬…ï¸ Ø±Ø¬ÙˆØ¹';
    backBtn.style.backgroundColor = 'gray';
    backBtn.style.marginRight = '10px';
    backBtn.style.textDecoration = 'none';
    backBtn.style.padding = '10px 20px';
    backBtn.style.borderRadius = '5px';
    backBtn.style.color = 'white';
    backBtn.style.cursor = 'pointer';
    backBtn.onclick = function(e) {
      e.preventDefault();
      // Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø³Ù… ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
      if (fromSection === 'anime') {
        window.location.replace('index.html?from=anime');
      } else if (fromSection === 'series') {
        window.location.replace('index.html?from=series');
      } else if (fromSection === 'egyptianSeries') {
        window.location.replace('index.html?from=egyptianSeries');
      } else {
        window.location.replace('index.html');
      }
    };
    document.querySelector('.details-buttons').prepend(backBtn);

    // âœ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
    document.getElementById("watch-link").addEventListener("click", function (e) {
      e.preventDefault();
      if (watchLink.endsWith(".mp4") || watchLink.includes("video")) {
        document.getElementById("video-source").src = watchLink;
        document.getElementById("video-player").load();
        document.getElementById("video-player-container").style.display = "block";
        document.getElementById("video-player-container").scrollIntoView({ behavior: "smooth" });
      } else {
        window.open(watchLink, "_blank");
      }
    });

    // âœ… Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ø³Øª Ø¥Ù† ÙˆÙØ¬Ø¯
    const castContainer = document.getElementById("cast-container");
    if (castData) {
      try {
        const castList = JSON.parse(decodeURIComponent(castData));
        if (Array.isArray(castList) && castList.length > 0) {
          castList.forEach(member => {
            const div = document.createElement("div");
            div.className = "cast-member";
            div.innerHTML = `
              <img src="${member.image || window.defaultPoster}" alt="${member.name}" onerror="this.src='${window.defaultPoster}'" />
              <strong>${member.name}</strong>
              ${member.character && !/^\(?self\)?$/i.test(member.character.trim()) ? `<p>${member.character}</p>` : ''}
            `;
            castContainer.appendChild(div);
          });
        } else {
          castContainer.innerHTML = '<p style="color:#aaa;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… Ø¹Ù…Ù„ Ù…ØªÙˆÙØ±.</p>';
        }
      } catch (e) {
        castContainer.innerHTML = '<p style="color:#aaa;">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø·Ø§Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„.</p>';
        console.error("ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ§Ø³Øª:", e);
      }
    } else {
      castContainer.innerHTML = '<p style="color:#aaa;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… Ø¹Ù…Ù„ Ù…ØªÙˆÙØ±.</p>';
    }

    async function fetchMovieFromTMDB(title) {
      try {
        const searchUrl = `${BASE_URL}/search/movie?api_key=${API_KEY}&query=${encodeURIComponent(title)}`;
        const searchRes = await fetch(searchUrl);
        const searchData = await searchRes.json();
        if (searchData.results && searchData.results.length > 0) {
          const movie = searchData.results[0];
          // Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„ÙƒØ§Ø³Øª
          const detailsUrl = `${BASE_URL}/movie/${movie.id}?api_key=${API_KEY}&language=ar`;
          const creditsUrl = `${BASE_URL}/movie/${movie.id}/credits?api_key=${API_KEY}&language=ar`;
          const [detailsRes, creditsRes] = await Promise.all([
            fetch(detailsUrl),
            fetch(creditsUrl)
          ]);
          const details = await detailsRes.json();
          const credits = await creditsRes.json();
          return {
            title: details.title || title,
            rating: details.vote_average ? details.vote_average.toFixed(1) : "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
            image: details.poster_path ? IMAGE_BASE_URL + details.poster_path : window.defaultPoster,
            description: details.overview || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ.",
            cast: (credits.cast || []).slice(0, 10).map(member => ({
              name: member.name,
              character: member.character,
              image: member.profile_path ? IMAGE_BASE_URL + member.profile_path : window.defaultPoster
            }))
          };
        }
      } catch (e) {
        console.error("TMDB fetch error", e);
      }
      return null;
    }

    // âœ… Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙÙŠÙ„Ù… Ù…Ù† TMDB Ø¨Ø§Ù„Ù…Ø¹Ø±Ù Ù…Ø¨Ø§Ø´Ø±Ø©
    async function fetchMovieFromTMDBById(id) {
      try {
        const detailsUrl = `${BASE_URL}/movie/${id}?api_key=${API_KEY}&language=ar`;
        const creditsUrl = `${BASE_URL}/movie/${id}/credits?api_key=${API_KEY}&language=ar`;
        const [detailsRes, creditsRes] = await Promise.all([
          fetch(detailsUrl),
          fetch(creditsUrl)
        ]);
        const details = await detailsRes.json();
        const credits = await creditsRes.json();
        return {
          title: details.title || "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†",
          rating: details.vote_average ? details.vote_average.toFixed(1) : "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
          image: details.poster_path ? IMAGE_BASE_URL + details.poster_path : window.defaultPoster,
          description: details.overview || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ.",
          cast: (credits.cast || []).slice(0, 10).map(member => ({
            name: member.name,
            character: member.character,
            image: member.profile_path ? IMAGE_BASE_URL + member.profile_path : window.defaultPoster
          }))
        };
      } catch (e) {
        console.error("TMDB fetch error", e);
      }
      return null;
    }

    // âœ… Ø¯Ø¹Ù… Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³Ù„Ø³Ù„ Ø£ÙŠØ¶Ù‹Ø§ (tv)
    async function fetchShowFromTMDBById(id) {
      try {
        const detailsUrl = `${BASE_URL}/tv/${id}?api_key=${API_KEY}&language=ar`;
        const creditsUrl = `${BASE_URL}/tv/${id}/credits?api_key=${API_KEY}&language=ar`;
        const [detailsRes, creditsRes] = await Promise.all([
          fetch(detailsUrl),
          fetch(creditsUrl)
        ]);
        const details = await detailsRes.json();
        const credits = await creditsRes.json();
        return {
          title: details.name || title,
          rating: details.vote_average ? details.vote_average.toFixed(1) : "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
          image: details.poster_path ? IMAGE_BASE_URL + details.poster_path : window.defaultPoster,
          description: details.overview || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ.",
          cast: (credits.cast || []).slice(0, 10).map(member => ({
            name: member.name,
            character: member.character,
            image: member.profile_path ? IMAGE_BASE_URL + member.profile_path : window.defaultPoster
          }))
        };
      } catch (e) {
        console.error("TMDB fetch error", e);
      }
      return null;
    }

    async function fetchMoviePartsFromTMDB(movieId) {
      // Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙÙŠÙ„Ù… Ù„Ù…Ø¹Ø±ÙØ© belongs_to_collection
      const detailsUrl = `${BASE_URL}/movie/${movieId}?api_key=${API_KEY}&language=ar`;
      const detailsRes = await fetch(detailsUrl);
      const details = await detailsRes.json();
      let currentMovieId = Number(movieId);
      // Ø¥ØµÙ„Ø§Ø­: Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ Ø¨Ø¹Ø¶ Ø§Ù„Ø£ÙÙ„Ø§Ù… Ù„Ø§ ØªØ¹ÙˆØ¯ Ù…Ø¹ Ø®Ø§ØµÙŠØ© belongs_to_collection Ø±ØºÙ… Ø£Ù†Ù‡Ø§ Ø¬Ø²Ø¡ Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹Ø©
      // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ belongs_to_collectionØŒ Ø¬Ø±Ø¨ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„ÙÙŠÙ„Ù… + "Collection"
      if (details.belongs_to_collection && details.belongs_to_collection.id) {
        const collectionId = details.belongs_to_collection.id;
        const collectionUrl = `${BASE_URL}/collection/${collectionId}?api_key=${API_KEY}&language=ar`;
        const collectionRes = await fetch(collectionUrl);
        const collection = await collectionRes.json();
        if (collection.parts && collection.parts.length > 1) {
          // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø­Ø³Ø¨ release_date
          collection.parts.sort((a, b) => (a.release_date || '').localeCompare(b.release_date || ''));
          // Ø¥ØµÙ„Ø§Ø­: Ø¶Ø¹ Ø¹Ù„Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ
          return collection.parts.map(part => ({
            id: part.id,
            title: part.title,
            image: part.poster_path ? IMAGE_BASE_URL + part.poster_path : window.defaultPoster,
            type: 'movie',
            isCurrent: Number(part.id) === currentMovieId
          }));
        }
      } else {
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø®Ø§ØµÙŠØ© belongs_to_collection
        if (details.title) {
          // Ø¬Ø±Ø¨ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ÙÙŠÙ„Ù… ÙƒØ§Ù…Ù„Ø§Ù‹ ÙˆÙ„ÙŠØ³ ÙÙ‚Ø· Ø£ÙˆÙ„ ÙƒÙ„Ù…Ø©
          const searchColUrl = `${BASE_URL}/search/collection?api_key=${API_KEY}&language=ar&query=${encodeURIComponent(details.title)}`;
          let searchColRes = await fetch(searchColUrl);
          let searchColData = await searchColRes.json();
          // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ØŒ Ø¬Ø±Ø¨ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø£ÙˆÙ„ ÙƒÙ„Ù…Ø© ÙÙ‚Ø·
          if (!searchColData.results || searchColData.results.length === 0) {
            const firstWord = details.title.split(' ')[0];
            const searchColUrl2 = `${BASE_URL}/search/collection?api_key=${API_KEY}&language=ar&query=${encodeURIComponent(firstWord)}`;
            searchColRes = await fetch(searchColUrl2);
            searchColData = await searchColRes.json();
          }
          if (searchColData.results && searchColData.results.length > 0) {
            // Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¬Ù…ÙˆØ¹Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„ÙÙŠÙ„Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            const found = searchColData.results.find(col => col.name && (col.name.includes(details.title) || col.name.includes(details.title.split(' ')[0])));
            if (found && found.id) {
              const collectionUrl = `${BASE_URL}/collection/${found.id}?api_key=${API_KEY}&language=ar`;
              const collectionRes = await fetch(collectionUrl);
              const collection = await collectionRes.json();
              if (collection.parts && collection.parts.length > 1) {
                collection.parts.sort((a, b) => (a.release_date || '').localeCompare(b.release_date || ''));
                return collection.parts.map(part => ({
                  id: part.id,
                  title: part.title,
                  image: part.poster_path ? IMAGE_BASE_URL + part.poster_path : window.defaultPoster,
                  type: 'movie',
                  isCurrent: Number(part.id) === currentMovieId
                }));
              }
            }
          }
        }
      }
      return [];
    }

    async function fetchShowSeasonsFromTMDB(tvId) {
      // Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³Ù„Ø³Ù„ Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…ÙˆØ§Ø³Ù…
      const detailsUrl = `${BASE_URL}/tv/${tvId}?api_key=${API_KEY}&language=ar`;
      const detailsRes = await fetch(detailsUrl);
      const details = await detailsRes.json();
      if (details.seasons && details.seasons.length > 1) {
        return details.seasons.map(season => ({
          id: season.id,
          season_number: season.season_number,
          title: season.name,
          image: season.poster_path ? IMAGE_BASE_URL + season.poster_path : window.defaultPoster,
          tv_id: tvId,
          type: 'season'
        }));
      }
      return [];
    }

    function renderPartsList(parts, type, tvId) {
      const section = document.getElementById('parts-section');
      const list = document.getElementById('parts-list');
      if (parts && parts.length > 1) {
        section.style.display = 'block';
        list.innerHTML = '';
        parts.forEach(part => {
          const div = document.createElement('div');
          div.style.width = '120px';
          div.style.flex = '0 0 auto';
          div.style.textAlign = 'center';
          div.innerHTML = `
            <img src="${part.image}" alt="${part.title}" style="width:100px;height:150px;border-radius:8px;object-fit:cover;box-shadow:0 0 5px #000;${part.isCurrent ? 'border:3px solid red;' : ''}" onerror="this.src='${window.defaultPoster}'" />
            <div style="color:#fff;font-size:0.95rem;margin-top:5px;${part.isCurrent ? 'color:red;font-weight:bold;' : ''}">${part.title}${part.isCurrent ? ' (Ø§Ù„Ø­Ø§Ù„ÙŠ)' : ''}</div>
          `;
          div.style.cursor = part.isCurrent ? 'default' : 'pointer';
          if (!part.isCurrent) {
            div.onclick = function() {
              if (type === 'movie') {
                window.location.href = `details.html?tmdb_id=${part.id}&type=movie&from=${fromSection}`;
              } else if (type === 'season') {
                window.location.href = `details.html?tmdb_id=${tvId}&type=tv&season=${part.season_number}&from=${fromSection}`;
              }
            };
          }
          list.appendChild(div);
        });
      } else {
        section.style.display = 'none';
      }
    }

    async function autoFillIfNeeded() {
      if (tmdbId) {
        // Ø¯Ø¹Ù… Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ (ÙÙŠÙ„Ù… Ø£Ùˆ Ù…Ø³Ù„Ø³Ù„)
        const type = urlParams.get("type");
        let data = null;
        if (type === "tv") {
          data = await fetchShowFromTMDBById(tmdbId);
        } else {
          data = await fetchMovieFromTMDBById(tmdbId);
        }
        if (data && data.title && data.title !== "") {
          document.getElementById("details-title").textContent = data.title;
          document.getElementById("details-rating").textContent = `â­ ${data.rating}`;
          document.getElementById("details-description").textContent = data.description;
          document.getElementById("details-image").src = data.image;
          document.getElementById("details-image").onerror = function() { this.src = window.defaultPoster; };
          // Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ø³Øª
          const castContainer = document.getElementById("cast-container");
          if (data.cast && data.cast.length > 0) {
            castContainer.innerHTML = "";
            data.cast.forEach(member => {
              // Ø­Ø°Ù Ø§Ù„Ø´Ø®ØµÙŠØ§Øª Ø§Ù„ØªÙŠ Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙˆØ±Ø© Ø£ØµÙ„ÙŠØ© Ù…Ù† TMDB
              if (!member.image || member.image.includes('placeholder') || member.image === window.defaultPoster) return;
              const div = document.createElement("div");
              div.className = "cast-member";
              div.innerHTML = `
                <img src="${member.image}" alt="${member.name}" onerror="this.src='${window.defaultPoster}'" />
                <strong>${member.name}</strong>
                ${member.character && !/^\(?self\)?$/i.test(member.character.trim()) ? `<p>${member.character}</p>` : ''}
              `;
              castContainer.appendChild(div);
            });
            if (!castContainer.hasChildNodes()) {
              castContainer.innerHTML = '<p style="color:#aaa;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… Ø¹Ù…Ù„ Ù…ØªÙˆÙØ±.</p>';
            }
          } else {
            castContainer.innerHTML = '<p style="color:#aaa;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… Ø¹Ù…Ù„ Ù…ØªÙˆÙØ±.</p>';
          }
          // Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø£Ùˆ Ø§Ù„Ù…ÙˆØ§Ø³Ù…
          if (type === 'tv') {
            const seasons = await fetchShowSeasonsFromTMDB(tmdbId);
            renderPartsList(seasons, 'season', tmdbId);
          } else {
            const parts = await fetchMoviePartsFromTMDB(tmdbId);
            renderPartsList(parts, 'movie');
          }
        } else {
          // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù…Ù† TMDBØŒ Ø¬Ø±Ø¨ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
          if (title && title !== "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†") {
            const movie = await fetchMovieFromTMDB(title);
            if (movie) {
              document.getElementById("details-title").textContent = movie.title;
              document.getElementById("details-rating").textContent = `â­ ${movie.rating}`;
              document.getElementById("details-description").textContent = movie.description;
              document.getElementById("details-image").src = movie.image;
              document.getElementById("details-image").onerror = function() { this.src = window.defaultPoster; };
              // Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ø³Øª
              const castContainer = document.getElementById("cast-container");
              if (movie.cast && movie.cast.length > 0) {
                castContainer.innerHTML = "";
                movie.cast.forEach(member => {
                  // Ø­Ø°Ù Ø§Ù„Ø´Ø®ØµÙŠØ§Øª Ø§Ù„ØªÙŠ Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙˆØ±Ø© Ø£ØµÙ„ÙŠØ© Ù…Ù† TMDB
                  if (!member.image || member.image.includes('placeholder') || member.image === window.defaultPoster) return;
                  const div = document.createElement("div");
                  div.className = "cast-member";
                  div.innerHTML = `
                    <img src="${member.image}" alt="${member.name}" onerror="this.src='${window.defaultPoster}'" />
                    <strong>${member.name}</strong>
                    ${member.character && !/^\(?self\)?$/i.test(member.character.trim()) ? `<p>${member.character}</p>` : ''}
                  `;
                  castContainer.appendChild(div);
                });
                if (!castContainer.hasChildNodes()) {
                  castContainer.innerHTML = '<p style="color:#aaa;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… Ø¹Ù…Ù„ Ù…ØªÙˆÙØ±.</p>';
                }
              } else {
                castContainer.innerHTML = '<p style="color:#aaa;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… Ø¹Ù…Ù„ Ù…ØªÙˆÙØ±.</p>';
              }
            } else {
              document.getElementById("details-title").textContent = "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†";
              document.getElementById("details-rating").textContent = "â­ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
              document.getElementById("details-description").textContent = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ.";
              document.getElementById("details-image").src = window.defaultPoster;
              document.getElementById("cast-container").innerHTML = '<p style="color:#aaa;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… Ø¹Ù…Ù„ Ù…ØªÙˆÙØ±.</p>';
            }
          } else {
            document.getElementById("details-title").textContent = "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†";
            document.getElementById("details-rating").textContent = "â­ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
            document.getElementById("details-description").textContent = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ.";
            document.getElementById("details-image").src = window.defaultPoster;
            document.getElementById("cast-container").innerHTML = '<p style="color:#aaa;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… Ø¹Ù…Ù„ Ù…ØªÙˆÙØ±.</p>';
          }
        }
        return;
      }
      let needFetch = false;
      if (!image || image === window.defaultPoster) needFetch = true;
      if (!description || description === "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ.") needFetch = true;
      if (!rating || rating === "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ") needFetch = true;
      if (!castData) needFetch = true;

      if (needFetch && title && title !== "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†") {
        const movie = await fetchMovieFromTMDB(title);
        if (movie) {
          document.getElementById("details-title").textContent = movie.title;
          document.getElementById("details-rating").textContent = `â­ ${movie.rating}`;
          document.getElementById("details-description").textContent = movie.description;
          document.getElementById("details-image").src = movie.image;
          document.getElementById("details-image").onerror = function() { this.src = window.defaultPoster; };
          // Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ø³Øª
          const castContainer = document.getElementById("cast-container");
          if (movie.cast && movie.cast.length > 0) {
            castContainer.innerHTML = "";
            movie.cast.forEach(member => {
              // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø´Ø®ØµÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªØªÙˆÙØ± ØµÙˆØ±Ø© Ø£Ùˆ Ø§Ø³Ù…
              if (!member.image || member.image.includes('placeholder') || !member.name) return;
              const div = document.createElement("div");
              div.className = "cast-member";
              div.innerHTML = `
                <img src="${member.image}" alt="${member.name}" onerror="this.src=window.defaultPoster" />
                <strong>${member.name}</strong>
                ${member.character && !/^\(?self\)?$/i.test(member.character.trim()) ? `<p>${member.character}</p>` : ''}
              `;
              castContainer.appendChild(div);
            });
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ø¹Ù†ØµØ± Ø¨Ø¹Ø¯ Ø§Ù„ØªØµÙÙŠØ©
            if (!castContainer.hasChildNodes()) {
              castContainer.innerHTML = '<p style="color:#aaa;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… Ø¹Ù…Ù„ Ù…ØªÙˆÙØ±.</p>';
            }
          } else {
            castContainer.innerHTML = '<p style="color:#aaa;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù‚Ù… Ø¹Ù…Ù„ Ù…ØªÙˆÙØ±.</p>';
          }
        }
      }
    }

    // âœ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
    autoFillIfNeeded();
  </script>

</body>
</html>
